@model IEnumerable<Vehicle_Inspection.Models.User>
@{
    ViewData["Title"] = "Employee List";
    var q = Context.Request.Query;
    string searchVal = q["search"];
    string positionVal = q["position"];
    string teamVal = q["team"];
    string genderVal = q["gender"];
    string isActiveVal = string.IsNullOrWhiteSpace(q["isActive"]) ? "" : q["isActive"].ToString();

}



<link rel="stylesheet" href="~/css/employee/main.css" />

<div class="">
    @* <h2 class="text-center mb-4">Employee List</h2> *@

    <div class="row">
        <!-- Left: Filters (fixed) -->
        <div class="col-md-2">
       
            <div class="filters-container p-3 bg-light rounded">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fa-regular fa-address-book"></i>
                    </div>
                    <div>
                        <h2 class="page-title">Quản lý nhân sự</h2>
                        <p class="page-subtitle">Danh sách các nhân sự trong hệ thống</p>
                    </div>
                </div>
                <form method="get" asp-action="Index" asp-controller="Employee">
                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fa-solid fa-magnifying-glass me-2"></i> Tìm
                        </label>
                        <input type="text" name="search" class="form-control"
                               placeholder="Name or email" value="@searchVal" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fa-solid fa-id-badge me-2"></i> Chức vụ
                        </label>
                        <select name="position" class="form-select">
                            <option value="">Tất cả</option>
                            @foreach (var p in (List<Vehicle_Inspection.Models.Position>)ViewBag.Positions)
                            {
                                if (positionVal == p.PositionId.ToString())
                                {
                                    <option value="@p.PositionId" selected>@p.PositionName</option>
                                }
                                else
                                {
                                    <option value="@p.PositionId">@p.PositionName</option>
                                }
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fa-solid fa-people-group me-2"></i> Tổ
                        </label>
                        <select name="team" class="form-select">
                            <option value="">Tất cả</option>
                            @foreach (var t in (List<Vehicle_Inspection.Models.Team>)ViewBag.Teams)
                            {
                                if (teamVal == t.TeamId.ToString())
                                {
                                    <option value="@t.TeamId" selected>@t.TeamName</option>
                                }
                                else
                                {
                                    <option value="@t.TeamId">@t.TeamName</option>
                                }
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">
                            <i class="fa-solid fa-venus-mars me-2"></i> Giới tính
                        </label>
                        <select name="gender" class="form-select">
                            <option value="">Tất cả</option>
                            @if (genderVal == "Nam")
                            {
                                <option value="Nam" selected>Nam</option>
                                <option value="Nữ">Nữ</option>
                            }
                            else if (genderVal == "Nữ")
                            {
                                <option value="Nam">Nam</option>
                                <option value="Nữ" selected>Nữ</option>
                            }
                            else
                            {
                                <option value="Nam">Nam</option>
                                <option value="Nữ">Nữ</option>
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <div class="filter-section-title">
                            Trạng thái
                        </div>

                        <div class="status-pills" role="radiogroup" aria-label="Trạng thái">
                            <input class="btn-check" type="radio" name="isActive" id="isActive_all"
                                   value="" autocomplete="off" @(isActiveVal == "" ? "checked" : null)>
                            <label class="status-pill" for="isActive_all">
                              
                                <span>Tất cả</span>
                            </label>

                            <input class="btn-check" type="radio" name="isActive" id="isActive_true"
                                   value="true" autocomplete="off" @(isActiveVal == "true" ? "checked" : null)>
                            <label class="status-pill" for="isActive_true">
                             
                                <span>Đang hoạt động</span>
                            </label>

                            <input class="btn-check" type="radio" name="isActive" id="isActive_false"
                                   value="false" autocomplete="off" @(isActiveVal == "false" ? "checked" : null)>
                            <label class="status-pill" for="isActive_false">
                              
                                <span>Đã nghỉ</span>
                            </label>
                        </div>

                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Tra cứu</button>
                    </div>
                </form>

            </div>
        </div>

        <!-- Right: Employee cards (3 per row) -->
        <div class="col-md-10">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
                @foreach (var user in Model)
                {
                    <div class="col">
                        <div class="d-flex @(user.IsActive ? "employee-card" : "employee-card-delete")  h-100 justify-content-between">
                            <a asp-controller="Employee" asp-action="Edit" asp-route-id="@user.UserId" class="d-flex align-items-center p-3 text-decoration-none text-dark">
                                <div class="me-3">
                                    <img src="@(string.IsNullOrEmpty(user.ImageUrl) ? Url.Content("~/images/employee/anh34.jpg") : user.ImageUrl)" alt="Avatar" class="employee-avatar" />
                                </div>
                                <div class="flex-grow-1">
                                    <p class="mb-0" style="display: none"><strong>ID:</strong> @user.UserId</p>
                                    <p class="mb-0"><strong>Name:</strong> @user.FullName</p>
                                    <p class="mb-0"><strong>Birth:</strong> @(user.BirthDate?.ToString("yyyy-MM-dd") ?? "-")</p>
                                    <p class="mb-0"><strong>Position:</strong> @user.Position?.PositionName</p>
                                    <p class="mb-0"><strong>Level:</strong> @(string.IsNullOrEmpty(user.Level) ? "-" : user.Level)</p>
                                    <p class="mb-0">
                                        <strong>Trạng thái:
                                            <span style="font-size: 14px" class="@(user.IsActive ? "text-success" : "text-danger")">
                                                @(user.IsActive ? "Đang hoạt động" : "Đã nghỉ")
                                            </span>
                                         </strong>
                                     </p>
                                </div>
                            </a>
                            @if (!user.IsActive)
                            {
                                <form asp-controller="Employee" asp-action="Restore" asp-route-id="@user.UserId"
                                      method="post" style="display:inline"
                                      class="no-loading"
                                      onsubmit="if(!confirm('Xác nhận khôi phục cán bộ @user.FullName?')) return false; showFullScreenLoading('Đang xử lý...');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-link px-2 btnDelete">
                                        <i class="fa-solid fa-arrow-rotate-left fa-xl" style="color: #f33939;"></i>
                                    </button>
                                </form>
                            }
                            else
                            {
                                <form asp-controller="Employee" asp-action="DeleteSoft" asp-route-id="@user.UserId"
                                      method="post" style="display:inline"
                                      class="no-loading"
                                      onsubmit="if(!confirm('Xác nhận xóa cán bộ @user.FullName?')) return false; showFullScreenLoading('Đang xử lý...');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-link px-2 btnDelete">
                                        <i class="fa-solid fa-delete-left fa-2xl" style="color:#10A37F;"></i>
                                    </button>
                                </form>

                            }

                        </div>
                        
                        
                        
                    </div>
                }
                @if (isActiveVal != "false")
                {
                    <div class="col">
                    <div class="card employee-card h-100">
                        <a asp-controller="Employee" asp-action="Create" class="d-flex align-items-center p-3 text-decoration-none text-dark">
                            <div class="me-3">
                                <img src="/images/employee/add-user.png" alt="Avatar" class="employee-avatar" style="object-fit: contain" />
                            </div>
                            <div class="flex-grow-1">
                                
                                <p class="mb-1"><strong>Name:</strong>...</p>
                                <p class="mb-1"><strong>Birth:</strong>...</p>
                                <p class="mb-1"><strong>Position:</strong>...</p>
                                <p class="mb-0"><strong>Level:</strong>...</p>
                            </div>
                        </a>
                    </div>
                </div>                  
                }
            </div>
            @if (ViewBag.TotalPages > 1)
            {
                <div class="row mt-4">
                    <div class="col-12">
                        <nav aria-label="Page navigation">
                            <ul class="pagination justify-content-center">
                                <!-- Previous -->
                                <li class="page-item @(ViewBag.CurrentPage == 1 ? "disabled" : "")">
                                    <a class="page-link" 
                                       href="@Url.Action("Index", new { 
                                           search = searchVal, 
                                           position = positionVal, 
                                           team = teamVal, 
                                           gender = genderVal, 
                                           isActive = isActiveVal,
                                           page = ViewBag.CurrentPage - 1 
                                       })">
                                       <i class="fa-solid fa-caret-left"></i>
                                    </a>
                                </li>

                                @{
                                    int currentPage = ViewBag.CurrentPage;
                                    int totalPages = ViewBag.TotalPages;
                                    int startPage = Math.Max(1, currentPage - 2);
                                    int endPage = Math.Min(totalPages, currentPage + 2);
                                }

                                @if (startPage > 1)
                                {
                                    <li class="page-item">
                                        <a class="page-link" 
                                           href="@Url.Action("Index", new { 
                                               search = searchVal, 
                                               position = positionVal, 
                                               team = teamVal, 
                                               gender = genderVal, 
                                               isActive = isActiveVal,
                                               page = 1 
                                           })">1</a>
                                    </li>
                                    @if (startPage > 2)
                                    {
                                        <li class="page-item disabled"><span class="page-link">...</span></li>
                                    }
                                }

                                @for (int i = startPage; i <= endPage; i++)
                                {
                                    <li class="page-item @(i == currentPage ? "active" : "")">
                                        <a class="page-link" 
                                           href="@Url.Action("Index", new { 
                                               search = searchVal, 
                                               position = positionVal, 
                                               team = teamVal, 
                                               gender = genderVal, 
                                               isActive = isActiveVal,
                                               page = i 
                                           })">@i</a>
                                    </li>
                                }

                                @if (endPage < totalPages)
                                {
                                    @if (endPage < totalPages - 1)
                                    {
                                        <li class="page-item disabled"><span class="page-link">...</span></li>
                                    }
                                    <li class="page-item">
                                        <a class="page-link" 
                                           href="@Url.Action("Index", new { 
                                               search = searchVal, 
                                               position = positionVal, 
                                               team = teamVal, 
                                               gender = genderVal, 
                                               isActive = isActiveVal,
                                               page = totalPages 
                                           })">@totalPages</a>
                                    </li>
                                }

                                <!-- Next -->
                                <li class="page-item @(ViewBag.CurrentPage >= ViewBag.TotalPages ? "disabled" : "")">
                                    <a class="page-link" 
                                       href="@Url.Action("Index", new { 
                                           search = searchVal, 
                                           position = positionVal, 
                                           team = teamVal, 
                                           gender = genderVal, 
                                           isActive = isActiveVal,
                                           page = ViewBag.CurrentPage + 1 
                                       })">
                                        <i class="fa-solid fa-caret-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
            
                        <p class="text-center text-muted">
                            Trang @ViewBag.CurrentPage / @ViewBag.TotalPages (Tổng: @ViewBag.TotalItems nhân viên)
                        </p>
                    </div>
                </div>
            }
                   
        </div>
            <!-- Pagination -->

    </div>
</div>


